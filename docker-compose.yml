# DeskPilot Demo Environment
# Self-contained Windows 11 VM with DeskPilot pre-installed
#
# Quick Start:
#   docker-compose up -d
#   Open browser to http://localhost:8006
#
# The VM includes:
#   - Windows 11
#   - Ollama + qwen2.5:3b model (pre-loaded)
#   - DeskPilot (pre-installed)
#   - OpenClaw TUI (auto-starts on login)
#   - Calculator pinned to taskbar for demo

services:
  deskpilot-demo:
    image: deskpilot/demo:latest
    build:
      context: .
      dockerfile: docker/Dockerfile.demo
    container_name: deskpilot-demo
    restart: unless-stopped

    # Port mappings
    ports:
      - "8006:8006"   # noVNC web interface (access via browser)
      - "5900:5900"   # VNC direct access (optional)

    # Persistent storage
    volumes:
      - deskpilot-storage:/storage
      - ./shared:/shared  # Share files with host

    # VM configuration
    environment:
      # Resources
      RAM_SIZE: ${DESKPILOT_RAM:-8G}
      CPU_CORES: ${DESKPILOT_CPUS:-4}
      DISK_SIZE: ${DESKPILOT_DISK:-64G}

      # Display
      DISPLAY_WIDTH: 1920
      DISPLAY_HEIGHT: 1080

      # Windows settings
      VERSION: "win11"
      LANGUAGE: "en-US"
      KEYBOARD: "en-US"

    # Resource limits
    deploy:
      resources:
        limits:
          memory: ${DESKPILOT_RAM:-8G}
        reservations:
          memory: 4G

    # Health check (wait for VNC to be ready)
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8006"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 180s  # Windows takes time to boot

    # Security options for QEMU
    security_opt:
      - seccomp:unconfined

    # KVM acceleration (Linux only - optional)
    # Uncomment if running on Linux with KVM support:
    # devices:
    #   - /dev/kvm

# Persistent volume for VM disk
volumes:
  deskpilot-storage:
    driver: local
